<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Student Portal</title>
    <link href="../dist/output.css" rel="stylesheet">
    <script src="../dist/tailwind.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <!-- Timer Header -->
    <div class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
        <div class="px-6 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 id="testTitle" class="text-lg font-bold text-gray-900">JavaScript Fundamentals Test</h1>
                    <span class="text-sm text-gray-500">|</span>
                    <span class="text-sm text-gray-500">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></span>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="submitTest()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200">
                        <i class="fas fa-stop mr-2"></i>
                        Submit Test
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="flex h-screen">
        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- Question Content -->
            <main class="flex-1 overflow-y-auto bg-gray-50">
                <div class="px-6 py-8">
                    <!-- Question Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                        <div class="p-6">
                            <div id="questionContent">
                                <!-- Question content will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex items-center justify-between">
                        <button id="prevBtn" onclick="previousQuestion()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Previous
                        </button>
                        
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-500">Question</span>
                            <span id="questionCounter" class="text-sm font-medium text-gray-900">1 of 10</span>
                        </div>
                        
                        <button id="nextBtn" onclick="nextQuestion()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200">
                            Next
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Test data
        const testQuestions = {
            1: [
                {
                    id: 1,
                    question: "What is JavaScript?",
                    type: "multiple-choice",
                    options: {
                        A: "A programming language for creating interactive web pages",
                        B: "A markup language for structuring web content",
                        C: "A styling language for web design",
                        D: "A database management system"
                    },
                    correctAnswer: "A"
                },
                {
                    id: 2,
                    question: "Which keyword is used to declare a variable in JavaScript?",
                    type: "multiple-choice",
                    options: {
                        A: "var",
                        B: "let",
                        C: "const",
                        D: "All of the above"
                    },
                    correctAnswer: "D"
                },
                {
                    id: 3,
                    question: "What is the correct way to write a JavaScript array?",
                    type: "multiple-choice",
                    options: {
                        A: "var colors = (1:'red', 2:'green', 3:'blue')",
                        B: "var colors = 'red', 'green', 'blue'",
                        C: "var colors = ['red', 'green', 'blue']",
                        D: "var colors = 1 = ('red'), 2 = ('green'), 3 = ('blue')"
                    },
                    correctAnswer: "C"
                },
                {
                    id: 4,
                    question: "How do you write a conditional statement in JavaScript?",
                    type: "multiple-choice",
                    options: {
                        A: "if i = 5 then",
                        B: "if (i == 5)",
                        C: "if i == 5 then",
                        D: "if i = 5"
                    },
                    correctAnswer: "B"
                },
                {
                    id: 5,
                    question: "Which event occurs when the user clicks on an HTML element?",
                    type: "multiple-choice",
                    options: {
                        A: "onchange",
                        B: "onclick",
                        C: "onmouseover",
                        D: "onmouseclick"
                    },
                    correctAnswer: "B"
                },
                {
                    id: 6,
                    question: "How do you create a function in JavaScript?",
                    type: "multiple-choice",
                    options: {
                        A: "function myFunction()",
                        B: "function:myFunction()",
                        C: "function = myFunction()",
                        D: "function myFunction"
                    },
                    correctAnswer: "A"
                },
                {
                    id: 7,
                    question: "How do you call a function named 'myFunction'?",
                    type: "multiple-choice",
                    options: {
                        A: "call myFunction()",
                        B: "call function myFunction()",
                        C: "myFunction()",
                        D: "function myFunction()"
                    },
                    correctAnswer: "C"
                },
                {
                    id: 8,
                    question: "How to write an IF statement in JavaScript?",
                    type: "multiple-choice",
                    options: {
                        A: "if (x == 5)",
                        B: "if x == 5 then",
                        C: "if x = 5",
                        D: "if x == 5 then"
                    },
                    correctAnswer: "A"
                },
                {
                    id: 9,
                    question: "How does a WHILE loop start?",
                    type: "multiple-choice",
                    options: {
                        A: "while (i <= 10; i++)",
                        B: "while (i <= 10)",
                        C: "while i = 1 to 10",
                        D: "while (i <= 10; i++)"
                    },
                    correctAnswer: "B"
                },
                {
                    id: 10,
                    question: "How can you add a comment in a JavaScript?",
                    type: "multiple-choice",
                    options: {
                        A: "<!--This is a comment-->",
                        B: "//This is a comment",
                        C: "'This is a comment",
                        D: "/*This is a comment*/"
                    },
                    correctAnswer: "B"
                }
            ]
        };

        // Test state
        let currentQuestionIndex = 0;
        let answers = {};

        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }





        // Function to display question
        function displayQuestion(index) {
            const trainingId = parseInt(getUrlParameter('training'));
            const questions = testQuestions[trainingId];
            const question = questions[index];
            
            document.getElementById('currentQuestion').textContent = index + 1;
            document.getElementById('questionCounter').textContent = `${index + 1} of ${questions.length}`;
            
            const questionContent = document.getElementById('questionContent');
            questionContent.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Question ${index + 1}</h2>
                    <p class="text-gray-700 mb-6">${question.question}</p>
                    
                    <div class="space-y-3">
                        ${Object.entries(question.options).map(([key, value]) => `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200 ${
                                answers[index] === key ? 'bg-primary-50 border-primary-300' : ''
                            }">
                                <input type="radio" name="question${index}" value="${key}" 
                                       ${answers[index] === key ? 'checked' : ''}
                                       onchange="saveAnswer(${index}, '${key}')"
                                       class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300">
                                <span class="ml-3 text-sm font-medium text-gray-700">${key}. ${value}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === questions.length - 1;
        }

        // Function to save answer
        function saveAnswer(questionIndex, answer) {
            answers[questionIndex] = answer;
        }



        // Function to go to previous question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
            }
        }

        // Function to go to next question
        function nextQuestion() {
            const trainingId = parseInt(getUrlParameter('training'));
            const questions = testQuestions[trainingId];
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            }
        }

        // Function to submit test
        function submitTest() {
            const trainingId = parseInt(getUrlParameter('training'));
            const trainingTitle = getUrlParameter('title');
            const questions = testQuestions[trainingId];
            
            // Calculate score
            let correctAnswers = 0;
            questions.forEach((question, index) => {
                if (answers[index] === question.correctAnswer) {
                    correctAnswers++;
                }
            });
            
            const score = Math.round((correctAnswers / questions.length) * 100);
            const passed = score >= 70;
            
            // Show results
            const resultMessage = `
Test Results for ${trainingTitle}

Score: ${score}% (${correctAnswers}/${questions.length} correct)
Status: ${passed ? 'PASSED' : 'FAILED'}

${passed ? 'Congratulations! You have passed the test.' : 'You need to score at least 70% to pass. Please review the training materials and try again.'}
            `;
            
            alert(resultMessage);
            
            // Navigate to results page or back to trainings
            window.location.href = 'my-trainings.html';
        }

        // Initialize test when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const trainingId = parseInt(getUrlParameter('training'));
            const trainingTitle = getUrlParameter('title');
            
            if (!trainingId || !testQuestions[trainingId]) {
                alert('Test not found');
                window.location.href = 'my-trainings.html';
                return;
            }
            
            // Update page title
            document.getElementById('testTitle').textContent = `${trainingTitle} Test`;
            document.getElementById('totalQuestions').textContent = testQuestions[trainingId].length;
            
            // Display first question
            displayQuestion(0);
            
            // Warn user before leaving page
            window.addEventListener('beforeunload', function(e) {
                e.preventDefault();
                e.returnValue = 'Are you sure you want to leave? Your test progress will be lost.';
            });
        });
    </script>
</body>
</html>
